OSINT Lab â€” Experiment No. 8
Title: IP Geolocation & Geospatial Profiling

8.1 Aim
Determine the geolocation (country, region, city â€” approximate) for at least 10 IP addresses using OSINT techniques and tools (GeoIP databases, WHOIS, reverse DNS, traceroute, web APIs).

8.2 Course Outcome
Demonstrate digital footprinting and geospatial profiling using OSINT tools.

8.3 Learning Objectives
Use GeoIP services and public records to map IP â†’ location. Corroborate results across multiple sources (WHOIS, GeoIP DBs, reverse DNS, traceroute).Understand limits of accuracy and ethical constraints.

8.4 Requirements
OS: Windows or Linux (Kali recommended).
Internet connection.
Tools: whois, dig (or nslookup), traceroute, curl, jq (optional), GeoIP lookup tool or API (ipinfo/ip-api/MaxMind).
Optional: ipinfo token for higher rate limits.

8.5 Related Theory (short)
IP Geolocation: maps IPs to approximate locations using vendor databases (MaxMind, DB-IP), RIR/WHOIS records, BGP/AS info and public metadata. Country-level is usually reliable; city-level often imprecise. Sources: WHOIS/RIR, GeoIP DBs, reverse DNS (PTR), BGP/AS lookup, traceroute/latency, web APIs.Corroboration: combine multiple sources to increase confidence. Limitations & Ethics: geolocation is probabilistic; do not expose personal data or perform intrusive scans without permission.

8.6 program and output:

8.7 Conclusion This experiment demonstrates how OSINT and low-impact active tools can profile IPs to produce an approximate geolocation and provide context (ISP/AS, PTR, routing). Use multiple corroborating sources to increase confidence. Always respect privacy, legal constraints, and never perform intrusive scanning without explicit authorization.




IP Geolocation â€“ Easy Steps

1. ðŸ“ Create the Input File (ips.txt)
This command creates a file containing the 10 IP addresses you intend to analyze.


cat > ips.txt <<'IPLIST'
203.0.113.12
128.51.100.7
192.0.2.45
45.33.32.156
151.101.1.69
13.35.8.35
104.16.132.229
185.199.110.153
8.8.8.8
1.1.1.1
IPLIST





2. âš™ï¸ Install Required Tools (Prerequisites)
This step ensures all necessary command-line utilities are installed and up to date on your system.

sudo apt update -y
sudo apt install -y whois geoip-bin jq dnsutils traceroute curl




3. âœï¸ Create and Execute the Automation Script (geolocate_ips.sh)
This is the core step that creates the script file, which includes the necessary directory creation fix and the execution logic for all five types of lookups.  

copy from here 

# 1. Create the script file (geolocate_ips.sh) and define its content
cat > geolocate_ips.sh <<'SCRIPT_EOF'
#!/bin/bash

# --- FIX: Define and create output directory first ---
OUTDIR="geo_results"
mkdir -p "$OUTDIR"

# --- Setup Summary File with Headers ---
SUMMARY_FILE="geolocation_summary.csv"
echo "IP,Country_GeoIP,PTR_Hostname,WHOIS_Org,IPInfo_City,IPInfo_Region,IPInfo_Country,Traceroute_LastHop_IP" > "$SUMMARY_FILE"

echo "Starting geolocation for IPs in ips.txt. Raw results will be saved to $OUTDIR/"
echo "Summary output compiling to $SUMMARY_FILE"

# --- Core Loop: Read each IP from the file (handles IPs with whitespace/blank lines) ---
while IFS= read -r rawip || [ -n "$rawip" ]; do
    # Clean the IP and skip if empty
    IP=$(echo "$rawip" | tr -d '[:space:]')
    if [ -z "$IP" ]; then continue; fi

    echo "--- Processing: $IP ---"

    # Define output files for raw data
    WHOIS_F="${OUTDIR}/${IP}_whois.txt"
    GEOIP_F="${OUTDIR}/${IP}_geoip.txt"
    IPINFO_F="${OUTDIR}/${IP}_ipinfo.json"
    PTR_F="${OUTDIR}/${IP}_ptr.txt"
    TR_F="${OUTDIR}/${IP}_traceroute.txt"

    # 1. GeoIP Database Lookup (Country approximation)
    geoiplookup "$IP" > "$GEOIP_F" 2>/dev/null
    GEOIP_INFO=$(grep "GeoIP" "$GEOIP_F" | cut -d ':' -f 2 | tr -d '[:space:]' | tr -d ',' | head -n 1)

    # 2. WHOIS Lookup (Organization/Owner)
    whois "$IP" > "$WHOIS_F"
    WHOIS_ORG=$(grep -E 'OrgName|organization:' "$WHOIS_F" | head -n 1 | awk -F ':' '{print $2}' | sed 's/^[[:space:]]*//' | tr -d ',')

    # 3. Web API Lookup (Detailed Location via curl/jq)
    curl -s "https://ipinfo.io/${IP}/json" -o "$IPINFO_F"
    CITY=$(jq -r '.city // "N/A"' "$IPINFO_F" | tr -d ',')
    REGION=$(jq -r '.region // "N/A"' "$IPINFO_F" | tr -d ',')
    COUNTRY=$(jq -r '.country // "N/A"' "$IPINFO_F" | tr -d ',')

    # 4. Reverse DNS (PTR Record/Hostname)
    dig -x "$IP" +short > "$PTR_F"
    PTR_RECORD=$(cat "$PTR_F" | tr -d '[:space:]')
    
    # 5. Traceroute (Network Path)
    # Get the last hop's IP to estimate path length
    traceroute -m 10 -q 1 "$IP" > "$TR_F" 2>/dev/null
    LAST_HOP=$(grep -E '[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+' "$TR_F" | tail -n 1 | awk '{print $2}')
    
    # Generate the summary CSV line
    echo "$IP,$GEOIP_INFO,$PTR_RECORD,\"$WHOIS_ORG\",\"$CITY\",\"$REGION\",$COUNTRY,$LAST_HOP" >> "$SUMMARY_FILE"

done < ips.txt

echo -e "\n--- Processing Complete ---"
echo "Summary in: $SUMMARY_FILE"
echo "Raw output files in: $OUTDIR/"
SCRIPT_EOF

# 2. Make the newly created file executable
chmod +x geolocate_ips.sh

echo "Script geolocate_ips.sh successfully created and made executable."






4. ðŸ”‘ Final Check and Execution
This step confirms the script is ready to run and then launches the analysis.


# Final check to ensure the file is executable (if not already done in step 3)
chmod +x geolocate_ips.sh
echo "Script geolocate_ips.sh is now executable."


5. â–¶ï¸ Run the Script

./geolocate_ips.sh


6. ðŸ“Š Review Results
Once the script completes, use these commands to view the compiled summary and the raw evidence files.


echo -e "\n- Top 11 lines of geolocation_summary.csv (Includes Header)"
head -n 11 geolocation_summary.csv
echo -e "\n- Raw output files directory"
ls -1 geo_results


---------------------------------------------------------------------------------------
Other Way of Execution:

Step 1
open kali (or your Linux distro / WSL)
open terminal

sudo apt update
sudo apt install -y whois dnsutils traceroute mtr curl jq
# (dig is in dnsutils; tracert on Windows = tracert)


Step 2 â€” prepare ips file
create a text file ips.txt and add â‰¥10 IPs (one per line)
example:

8.8.8.8
1.1.1.1
93.184.216.34
151.101.1.69
52.95.110.1
104.244.42.1
142.250.190.78
13.225.66.11
172.217.0.46
52.94.236.248


Step 3 â€” GeoIP quick lookup (web + terminal)
Option A (browser): open https://ipinfo.io/
 paste IP â†’ note country, region, city, org, loc
Option B (terminal one-liner):

curl -s "http://ip-api.com/json/<IP>?fields=status,country,regionName,city,lat,lon,isp,org,as" | jq
# replace <IP>


Step 4 â€” WHOIS lookup (registration info)
Terminal:

whois <IP>


OR Browser: https://www.whois.com/whois/
 paste IP â†’ note OrgName, country, netrange

Step 5 â€” Reverse DNS (PTR)
Terminal:

dig -x <IP> +short    # linux/mac
# or
nslookup <IP>         # windows


OR Browser: https://mxtoolbox.com/ReverseLookup.aspx
 paste IP â†’ copy PTR hostname

Step 6 â€” Traceroute (path hints)
Terminal:

traceroute <IP>      # linux/mac
# or
tracert <IP>         # windows
# or concise
mtr --report <IP>


OR Online: https://tools.keycdn.com/traceroute
 or https://ping.eu/traceroute

Note last 2-3 stable hopsâ€™ hostnames (look for city codes: sfo, lon, fra, syd, bom, etc.)

Step 7 â€” ASN / BGP info
Browser: https://bgp.he.net/ip/
<IP> or https://ipinfo.io/
<IP>/json
Note ASN, AS Name, announced prefix




